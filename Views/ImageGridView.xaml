<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="WallTrek.Views.ImageGridView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WallTrek.Views">

    <UserControl.Resources>
        <local:FavoriteColorConverter x:Key="FavoriteColorConverter"/>
        <local:BooleanNegationConverter x:Key="BooleanNegationConverter"/>
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="20,20,20,10" Spacing="10">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="BackButton" Content="← Back" Click="BackButton_Click" Margin="0,0,20,0"/>
                <TextBlock Text="Image Grid" FontSize="24" FontWeight="SemiBold" VerticalAlignment="Center"/>
            </StackPanel>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Left side: Filters -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="15">
                    <CheckBox x:Name="FavoritesOnlyCheckBox"
                              Content="Favorites Only"
                              Checked="FilterCheckBox_Changed"
                              Unchecked="FilterCheckBox_Changed"/>
                    <CheckBox x:Name="NotUploadedOnlyCheckBox"
                              Content="Not Uploaded"
                              Checked="FilterCheckBox_Changed"
                              Unchecked="FilterCheckBox_Changed"/>
                </StackPanel>

                <!-- Right side: Count -->
                <TextBlock Grid.Column="1"
                           x:Name="ImageCountTextBlock"
                           Text="0/0 Images"
                           VerticalAlignment="Center"
                           FontWeight="SemiBold"
                           HorizontalAlignment="Right"/>
            </Grid>
        </StackPanel>

        <ScrollViewer Grid.Row="1" Margin="20,0,20,20" HorizontalScrollBarVisibility="Disabled">
            <StackPanel HorizontalAlignment="Center">
                <GridView x:Name="ImagesGrid"
                          SelectionMode="None"
                          IsItemClickEnabled="False"
                          HorizontalAlignment="Center">
                    <GridView.ItemTemplate>
                        <DataTemplate x:DataType="local:ImageGridItemViewModel">
                            <Border CornerRadius="8" BorderBrush="Gray" BorderThickness="1"
                                    Background="Transparent" Width="200" Height="200" Margin="4">
                                <Grid>
                                    <Button Background="Transparent" BorderThickness="0"
                                            Padding="0" Click="ImageButton_Click" RightTapped="ImageButton_RightTapped"
                                            Tag="{x:Bind}">
                                        <Button.ContextFlyout>
                                            <MenuFlyout Opening="ImageContextMenu_Opening">
                                                <MenuFlyoutItem Text="Set as Background"
                                                              Click="SetAsBackground_Click"
                                                              Tag="{x:Bind}">
                                                    <MenuFlyoutItem.Icon>
                                                        <FontIcon Glyph="&#xE91B;"/>
                                                    </MenuFlyoutItem.Icon>
                                                </MenuFlyoutItem>
                                                <MenuFlyoutSeparator/>
                                                <MenuFlyoutItem x:Name="UploadToDeviantArtItem"
                                                              Text="Upload to DeviantArt"
                                                              Click="UploadToDeviantArt_Click"
                                                              Tag="{x:Bind}"
                                                              IsEnabled="True"
                                                              Visibility="{x:Bind IsUploaded, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Invert, Mode=OneWay}"/>
                                                <MenuFlyoutItem x:Name="ViewOnDeviantArtItem"
                                                              Text="View on DeviantArt"
                                                              Click="ViewOnDeviantArt_Click"
                                                              Tag="{x:Bind}"
                                                              Visibility="{x:Bind IsUploaded, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}"/>
                                                <MenuFlyoutSeparator Visibility="{x:Bind IsUploaded, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}"/>
                                                <MenuFlyoutItem x:Name="ToggleFavoriteItem"
                                                              Text="Add to Favorites"
                                                              Click="ToggleFavorite_Click"
                                                              Tag="{x:Bind}">
                                                    <MenuFlyoutItem.Icon>
                                                        <FontIcon Glyph="&#xE735;"/>
                                                    </MenuFlyoutItem.Icon>
                                                </MenuFlyoutItem>
                                                <MenuFlyoutSeparator/>
                                                <MenuFlyoutItem Text="Open Image"
                                                              Click="OpenImage_Click"
                                                              Tag="{x:Bind}">
                                                    <MenuFlyoutItem.Icon>
                                                        <FontIcon Glyph="&#xE8A7;"/>
                                                    </MenuFlyoutItem.Icon>
                                                </MenuFlyoutItem>
                                                <MenuFlyoutItem Text="Open in file explorer"
                                                              Click="OpenInExplorer_Click"
                                                              Tag="{x:Bind}"/>
                                            </MenuFlyout>
                                        </Button.ContextFlyout>
                                        <Image Source="{x:Bind ThumbnailImage, Mode=OneWay}"
                                               Stretch="UniformToFill"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"/>
                                    </Button>

                                    <!-- Favorite indicator (top-left) -->
                                    <Border Background="#80000000"
                                            CornerRadius="12"
                                            Width="24" Height="24"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Top"
                                            Margin="5,5,0,0"
                                            Visibility="{x:Bind IsFavorite, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
                                        <FontIcon Glyph="&#xE735;"
                                                FontSize="12"
                                                Foreground="{x:Bind IsFavorite, Converter={StaticResource FavoriteColorConverter}, Mode=OneWay}"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"/>
                                    </Border>

                                    <!-- Upload indicator (top-right) -->
                                    <Border Background="LimeGreen"
                                            CornerRadius="12"
                                            Width="24" Height="24"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Top"
                                            Margin="0,5,5,0"
                                            Visibility="{x:Bind IsUploaded, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
                                        <FontIcon Glyph="&#xE72E;"
                                                FontSize="12"
                                                Foreground="White"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"/>
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </GridView.ItemTemplate>
                </GridView>

                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            Spacing="10"
                            Margin="0,20,0,0">
                    <Button x:Name="LoadMoreButton"
                            Content="Load Next 100"
                            Click="LoadMoreButton_Click"
                            Visibility="Collapsed"
                            MinWidth="150"/>
                    <Button x:Name="LoadAllButton"
                            Content="Load All"
                            Click="LoadAllButton_Click"
                            Visibility="Collapsed"
                            MinWidth="150"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>

        <!-- Full screen image popup -->
        <Border x:Name="FullScreenOverlay" Grid.RowSpan="2" Background="Black" Opacity="0.9"
                Visibility="Collapsed" Tapped="FullScreenOverlay_Tapped">
            <Image x:Name="FullScreenImage" Stretch="Uniform" HorizontalAlignment="Center"
                   VerticalAlignment="Center" Tapped="FullScreenImage_Tapped"/>
        </Border>
    </Grid>
</UserControl>
